---
import CardCarrito from "./ui/CardCarrito.astro";
import Titulo from "./ui/Titulo.astro";
import carritoData from "../data/carrito.json";
import type { Libro } from "../types/libro";
let carrito: Libro[] = carritoData;
---

<div
  id="modal-carrito"
  role="dialog"
  aria-labelledby="titulo-carrito"
  aria-modal="true"
  class="fixed flex z-50 right-0 transition-all duration-1000 ease-in-out translate-x-650 justify-end  h-full w-full"
>
  <div
    class="border flex flex-col not-only-of-type: relative border-white bg-white h-full w-full max-w-sm"
  >
    <button
      id="cerrar-modal-carrito"
      class="botonRojo absolute right-1 top-1 px-2"
      aria-label="Cerrar carrito">âœ•</button
    >

    <Titulo titulo="Carrito de compras" />
    <ul class="space-y-2 h-[80svh] overflow-y-scroll flex flex-col px-4">
      {
        carrito.map((libro) => (
          <CardCarrito
            titulo={libro.titulo}
            cantidad={1}
            precio={libro.precio}
            imagen={libro.imagen}
          />
        ))
      }
    </ul>
    <a
      type="button"
      class="botonVerde px-8 border py-2 my-4 mx-auto text-center"
      href="/carrito-pago">pagar</a
    >
  </div>
</div>
<script src="../scripts/util/modal/carritoModal"></script>
<script type="module" is:inline>
  document.addEventListener("DOMContentLoaded", () => {

function aumentarCantidad(input) {
  const actual = parseInt(input.value || "1", 10);
  input.value = String(actual + 1);
}


function disminuirCantidad(input) {
  const actual = parseInt(input.value || "1", 10);
  if (actual > 1) {
    input.value = String(actual - 1);
  }
}

function inicializarGrupoCantidad(grupo) {
  const input = grupo.querySelector(".input-cantidad");
  const btnAumentar = grupo.querySelector(".btn-aumentar");
  const btnDisminuir = grupo.querySelector(".btn-disminuir");

  if (!input || !btnAumentar || !btnDisminuir) return;

  btnAumentar.addEventListener("click", () => aumentarCantidad(input));
  btnDisminuir.addEventListener("click", () => disminuirCantidad(input));
}


function inicializarControlesCantidad(selector = ".selector-cantidad") {
  const grupos = document.querySelectorAll(selector);
  grupos.forEach(inicializarGrupoCantidad);
}
 inicializarControlesCantidad();
  });
</script>
