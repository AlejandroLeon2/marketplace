---
import Titulo from "../ui/Titulo.astro"
---
<section class="w-full flex flex-col gap-6 px-8 py-6 max-w-4xl mx-auto">
  <!-- Encabezado del perfil -->
  <div class="flex items-center gap-6">
    <figure class="w-24 h-24 shrink-0">
      <img
        id="foto-perfil"
        src="/images/gato.jpg"
        alt="Foto de perfil de Juan de Las Nieves"
        class="w-full h-full object-cover rounded-full"
      />
    </figure>
    <div class="flex flex-col justify-center flex-1">
      <h2 class="text-2xl font-bold">
        <samp id="username">Cargando...</samp>
      </h2>
      <nav class="flex items-center gap-4 mt-2">

        <button id="cerrar-sesion" class="text-sm font-medium text-red-600 hover:underline">Cerrar Sesi칩n</button>
      </nav>
    </div>
  </div>

  <!-- Navegaci칩n de secciones -->
  <nav class="border-b border-gray-300">
    <ul class="flex gap-4">
      <li>
        <button data-perfil="perfildatos" class="px-4 botonBasico py-2 text-gray-700 focus:text-blue-500 hover:underline hover:text-blue-500">Perfil</button>
      </li>
      <li>
        <button data-perfil="pago" class="px-4 py-2 botonBasico text-gray-700 focus:text-blue-500 hover:underline hover:text-blue-500 ">
          Informaci칩n de Pago
        </button>
      </li>
    </ul>
  </nav>

  <!-- Datos personales -->
  <section id="perfildatos" class="flex seccion-perfil hidden flex-col gap-4">
    <Titulo titulo="Datos Personales"/>
    <dl class="grid gap-4">
      <div>
        <dt class="text-sm font-medium text-gray-600">Nombres</dt>
        <dd class="text-base text-gray-900">Pedrio Angustia</dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-gray-600">Apellidos</dt>
        <dd class="text-base text-gray-900">Alejandro Mango</dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-gray-600">Nickname</dt>
        <dd class="text-base text-gray-900">Spantan3000</dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-gray-600">Email</dt>
        <dd class="text-base text-gray-900"><samp id="email">Cargando...</samp></dd>
      </div>
    </dl>
  </section>
  <section id="pago" class="seccion-perfil hidden">
    <Titulo titulo="Datos de Pago"/>
  </section>
</section>


<script>
  import { logOut } from "../../services/auth.js";
  import { $user } from "../../stores/userStore.js";

  $user.subscribe((userState) => {
    if (userState.data) {
      const user = userState.data;
      (document.getElementById("username") as HTMLParagraphElement).textContent = user.displayName || user.email || "Usuario";
      (document.getElementById("email") as HTMLParagraphElement).textContent = user.email || "";
      (document.getElementById("foto-perfil") as HTMLImageElement).src = user.photoURL || "/images/gato.jpg";
    }
  });

  document.getElementById("cerrar-sesion")?.addEventListener("click", async () => {
    await logOut();
    // Redirige al login o p치gina principal
    window.location.href = "/inicio-usuario";
  });
</script>